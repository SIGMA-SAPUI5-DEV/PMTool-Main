sap.ui.define([
	"sap/ui/core/mvc/Controller",
	"sap/ui/core/routing/History",
	"sap/m/MessageToast"
], function(Controller, History, MessageToast) {
	"use strict";
	return Controller.extend("ZNav.controller.V_Tech_Copy", {

		onInit: function() {
			var oRouter = sap.ui.core.UIComponent.getRouterFor(this);
			oRouter.getRoute("Route_Tech_Copy").attachPatternMatched(this._onObjectMatched, this);
			// oRouter.attachRouteMatched(function(oEvent) {
			// var team = oEvent.getParameter("arguments").team;
			this.oTable = this.getView().byId("Dev_Table");
			this.oModel = this.getView().getModel();
			this.rebindTable();
			
			
		},
			rebindTable: function(){
			this.oTable.bindRows({
			path: "/TechTrackerSet",
			Key:  ["Zobjnr"]
			});
			},

		_onObjectMatched: function(oEvent) {

			var ProjId = oEvent.getParameter("arguments").ProjId;
			var GapNo = oEvent.getParameter("arguments").GapNo;
			var SpecName = oEvent.getParameter("arguments").SpecName;
			var SpecVer = oEvent.getParameter("arguments").SpecVer;
			var SeqNo = oEvent.getParameter("arguments").SeqNo;
			var SpecDesc = oEvent.getParameter("arguments").SpecDesc;
			var Domain = oEvent.getParameter("arguments").Domain;
			var Team = oEvent.getParameter("arguments").Team;
			var Category = oEvent.getParameter("arguments").Category;
			var TktNo = oEvent.getParameter("arguments").TktNo;
			var StatusDev = oEvent.getParameter("arguments").StatusDev;
			var DevScope = oEvent.getParameter("arguments").DevScope;
			var DevType = oEvent.getParameter("arguments").DevType;
			var Complexity = oEvent.getParameter("arguments").Complexity;
			var AssiBy = oEvent.getParameter("arguments").AssiBy;
			var OwnerOns = oEvent.getParameter("arguments").OwnerOns;
			var OwnerOffsh = oEvent.getParameter("arguments").OwnerOffsh;
			var AssiDate = oEvent.getParameter("arguments").AssiDate;
			var PlanStart = oEvent.getParameter("arguments").PlanStart;
			var PlanEnd = oEvent.getParameter("arguments").PlanEnd;
			var Developer = oEvent.getParameter("arguments").Developer;

			this.getView().byId("iprojId").setValue(ProjId);
			this.getView().byId("igapNo").setValue(GapNo);
			this.getView().byId("ispecName").setValue(SpecName);
			this.getView().byId("ispecVer").setValue(SpecVer);
			this.getView().byId("iseqno").setValue(SeqNo);
			this.getView().byId("ispecDesc").setValue(SpecDesc);
			this.getView().byId("idomain").setValue(Domain);
			this.getView().byId("iteam").setValue(Team);
			this.getView().byId("icategory").setValue(Category);
			this.getView().byId("iticketNo").setValue(TktNo);
			this.getView().byId("istatusDev").setValue(StatusDev);
			this.getView().byId("idevScope").setValue(DevScope);
			this.getView().byId("idevType").setValue(DevType);
			this.getView().byId("icomplexity").setValue(Complexity);
			this.getView().byId("iassignedBy").setValue(AssiBy);
			this.getView().byId("iownerNmOnsite").setValue(OwnerOns);
			this.getView().byId("iownerOffsh").setValue(OwnerOffsh);
			this.getView().byId("iassignDate").setValue(AssiDate);
			this.getView().byId("iplanStart").setValue(PlanStart);
			this.getView().byId("iplanEnd").setValue(PlanEnd);
			this.getView().byId("ideveloper").setValue(Developer);
		},
		f_GotoTech: function() {
			//This code was generated by the layout editor.
			var oHistory = History.getInstance();
			var sPreviousHash = oHistory.getPreviousHash();
			// Go one screen back if you find a Hash
			if (sPreviousHash !== undefined) {
				window.history.go(-1);
			} // If you do not find a correct Hash, go to the Source screen using default router;
			else {
				var oRouter = sap.ui.core.UIComponent.getRouterFor(this);
				oRouter.navTo("", true);
			}
		},
		fTechSave: function() {
			
			var oview = this.getView();
			var dialog = new sap.m.BusyDialog({ text:'Please wait'});
			 dialog.open();
			 
			/*create operation*/
			var oModel = this.getView().getModel();
			var oEntry = {};
			oEntry.ZprojId = oview.byId("iprojId").getValue();
			oEntry.ZgapNo = oview.byId("igapNo").getValue();
			oEntry.ZspecName = oview.byId("ispecName").getValue();
			oEntry.ZspecVersion = oview.byId("ispecVer").getValue();
			oEntry.ZseqNo = oview.byId("iseqno").getValue();
			oEntry.ZspecDesc = oview.byId("ispecDesc").getValue();
			oEntry.Zdomain = oview.byId("idomain").getValue();
			oEntry.Zteam = oview.byId("iteam").getValue();
			oEntry.Zcategory = oview.byId("icategory").getValue();
			oEntry.zticketNo = oview.byId("iticketNo").getValue();
			oEntry.zstatusDev = oview.byId("istatusDev").getValue();
			oEntry.ZdevScope = oview.byId("idevScope").getValue();
			oEntry.ZdevType = oview.byId("idevType").getValue();
			oEntry.Zcomplexity = oview.byId("icomplexity").getValue();
			oEntry.ZassignedBy = oview.byId("iassignedBy").getValue();
			oEntry.OwnerNmOnsite = oview.byId("iownerNmOnsite").getValue();
			oEntry.OwnerNmOffsh = oview.byId("iownerOffsh").getValue();
			var ozassignDate = oview.byId("iassignDate").getDateValue();
			var oZplanStart = oview.byId("iplanStart").getDateValue();
			var oZplanEnd = oview.byId("iplanEnd").getDateValue();
			
			var oFormatDate = sap.ui.core.format.DateFormat.getDateTimeInstance({
			pattern: "yyyy-MM-ddTKK:mm:ss"});
			oEntry.zassignDate = oFormatDate.format(ozassignDate);
			oEntry.ZplanStart = oFormatDate.format(oZplanStart);
            oEntry.ZplanEnd = oFormatDate.format(oZplanEnd);
            
			oEntry.Zdeveloper = oview.byId("ideveloper").getValue();

			oModel.update("/TechTrackerSet", oEntry, {
				method: "PUT",
				success: function(data) {
					dialog.close();
					MessageToast.show("Record has been saved successfully");
					// MessageToast.show("Record has been saved");
								var oHistory = History.getInstance();
			var sPreviousHash = oHistory.getPreviousHash();
			// Go one screen back if you find a Hash
			if (sPreviousHash !== undefined) {
				window.history.go(-1);
			} // If you do not find a correct Hash, go to the Source screen using default router;
			else {
				var oRouter = sap.ui.core.UIComponent.getRouterFor(this);
				oRouter.navTo("", true);
			}
				},
				error: function(e) {
					dialog.close();
					MessageToast.show("Error occured while saving record");
				}
			});
		},
		
		fTechCancel: function() {
			var dialog = new sap.m.BusyDialog({ text:'Please wait'});
			 dialog.open();

			this.getView().byId("bCreate").setVisible(true);
			this.getView().byId("bChange").setVisible(true);
			// this.getView().byId("bDelete").setVisible(true);
			this.getView().byId("bSave").setVisible(false);
			this.getView().byId("bCancel").setVisible(false);

			// var oTable = this.getView().byId("idTechTable");
			// var oModel = oTable.getModel();
			// var aIndex = oTable.getSelectedIndex();
			// var selectedRow = oTable.getRows()[aIndex];
			// for (var i = 0; i < 14; i++) {
			// 	selectedRow.getCells()[i].setProperty("editable", false);
			// }
			var oTable = this.getView().byId("idTechTable");
			var oModel = oTable.getModel();
			
			oModel.setProperty("/TechTrackerSet", this.aDevMasterSet);
			this.rebindTable();
			
			dialog.close();
			
		
		}

	});

});