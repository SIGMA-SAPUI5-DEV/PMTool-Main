sap.ui.define([
	"sap/ui/core/mvc/Controller", "sap/ui/core/routing/History", "sap/m/MessageBox"
], function(Controller, History, MessageBox) {
	"use strict";


	return Controller.extend("PMTool.controller.V_Project_Create", {
		onExit: function() {

		},

		fGoToTarget_1: function(Evt) {
			//This code was generated by the layout editor.
			this.getView().byId("idProjId").setValue("");
			this.getView().byId("idProjDesc").setValue("");
			this.getView().byId("idProjStart").setValue("");
			this.getView().byId("idProjEnd").setValue("");
			var oHistory = History.getInstance();
			var sPreviousHash = oHistory.getPreviousHash();
			// Go one screen back if you find a Hash
			if (sPreviousHash !== undefined) {
				window.history.go(-1);

			} // If you do not find a correct Hash, go to the Source screen using default router;
			else {
				var oRouter = sap.ui.core.UIComponent.getRouterFor(this);
				oRouter.navTo("", true);
			}
		},

		fSaveProj: function() {
			/*create operation*/
			var oModel = this.getView().getModel();
			var iError = 0;
			var oEntry = {};
			oEntry.ZprojId = this.getView().byId("idProjId").getValue();

			if (oEntry.ZprojId === "" || oEntry.ZprojId < 1) {
				this.getView().byId("idProjId").setValueState(sap.ui.core.ValueState.Error);
				this.getView().byId("idProjId").setTooltip("Pls enter a number between 1 and 999");
				iError++;
			} else {
				this.getView().byId("idProjId").setValueState(sap.ui.core.ValueState.None);
				this.getView().byId("idProjId").destroyTooltip();
			}

			oEntry.ZprDesc = this.getView().byId("idProjDesc").getValue();
			var oFormatDate = sap.ui.core.format.DateFormat.getDateTimeInstance({
				pattern: "yyyy-MM-ddTKK:mm:ss"
			});
			var dPrdate = this.getView().byId("idProjStart").getDateValue();
			if (dPrdate === null) {


				this.getView().byId("idProjStart").setValueState(sap.ui.core.ValueState.Error);
				this.getView().byId("idProjStart").setTooltip("Pls enter the date");
				iError++;
			} else {
				this.getView().byId("idProjStart").setValueState(sap.ui.core.ValueState.None);
				this.getView().byId("idProjStart").destroyTooltip();
			}
			oEntry.ZprStdate = oFormatDate.format(dPrdate);
			dPrdate = this.getView().byId("idProjEnd").getDateValue();
			if (dPrdate === null) {
				this.getView().byId("idProjEnd").setValueState(sap.ui.core.ValueState.Error);
				this.getView().byId("idProjEnd").setTooltip("Pls enter the date");
				iError++;
			} else {
				this.getView().byId("idProjEnd").setValueState(sap.ui.core.ValueState.None);
				this.getView().byId("idProjEnd").destroyTooltip();

				oEntry.ZprEndate = oFormatDate.format(dPrdate);
				if (oEntry.ZprStdate > oEntry.ZprEndate) {
					this.getView().byId("idProjEnd").setTooltip("Project End date cannot be less than Project Start Date");
					this.getView().byId("idProjEnd").setValueState(sap.ui.core.ValueState.Error);
					iError++;
				} else {
					this.getView().byId("idProjEnd").setValueState(sap.ui.core.ValueState.None);
					this.getView().byId("idProjEnd").destroyTooltip();
				}
			}
			if (iError > 0) {
				return;
			} else {
				var self = this;
				oModel.create("/ProjMasterSet", oEntry, {
					method: "POST",
					success: function(data) {
						MessageBox.success("Record created",{
						onClose:function(oAction){
							self.fGoToTarget_1(); }
								
						});
					},
					error: function(e) {
						MessageBox.error("Entry already exists");
					}
				});
			}
			

		}
	});

});